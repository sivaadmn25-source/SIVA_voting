<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ballot Paper</title>

<style>
/* === Global Setup (No change needed) === */
*, *::before, *::after {
Â  Â  box-sizing: border-box;
Â  Â  margin: 0;
Â  Â  padding: 0;
}

body {
Â  Â  font-family: 'Inter', sans-serif;
Â  Â  background-color: #f0f2f5;
Â  Â  display: flex;
Â  Â  flex-direction: column;
Â  Â  justify-content: flex-start;
Â  Â  align-items: center;
Â  Â  min-height: 100vh;
Â  Â  padding-top: 100px;
Â  Â  color: #333;
Â  Â  line-height: 1.4;
}

/* === BANNER (RIBBON) CORRECTION === */
.ribbon {
Â  Â  width: 100%;
Â  Â  max-width: 600px; /* CORRECTED from 800px to 600px */
Â  Â  height: 70px;
Â  Â  background: linear-gradient(to bottom, #FF9933 33.33%, #FFFFFF 66.66%, #4e5eef 100%);
Â  Â  position: fixed;
Â  Â  top: 20px;
Â  Â  left: 50%;
Â  Â  transform: translateX(-50%);
Â  Â  z-index: 1000;
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  border-radius: 8px;
Â  Â  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}
Â  .ribbon h1 { 
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  gap: 5px;
Â  Â  font-size: 2rem;
Â  Â  font-weight: 800;
Â  Â  background: linear-gradient(to bottom, #FF9933 33.33%, #FFFFFF 66.66%, #138808 100%);
Â  Â  -webkit-background-clip: text;
Â  Â  -webkit-text-fill-color: #0000FF;
Â  Â  letter-spacing: 2px;
Â  }

Â  .ribbon .siva-text {
Â  Â  font-weight: 800;
Â  Â  font-size: 2.2rem;
Â  Â  line-height: 1;
Â  Â  background: linear-gradient(270deg, gold, orange, yellow, green, blue, indigo, violet, gold);
Â  Â  background-size: 400% 100%;
Â  Â  -webkit-background-clip: text;
Â  Â  -webkit-text-fill-color: transparent;
Â  Â  animation: rainbow 5s linear infinite, flash 1s step-start infinite;
Â  }

@keyframes rainbow {
Â  Â  0% {
Â  Â  Â  Â  background-position: 0% 50%;
Â  Â  }
Â  Â  50% {
Â  Â  Â  Â  background-position: 100% 50%;
Â  Â  }
Â  Â  100% {
Â  Â  Â  Â  background-position: 0% 50%;
Â  Â  }
}


/* === CONTAINER CORRECTION === */
.container {
Â  Â  width: 95%;
Â  Â  max-width: 600px; /* CORRECTED from 800px to 600px */
Â  Â  background-color: white;
Â  Â  padding: 20px;
Â  Â  border-radius: 10px;
Â  Â  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
Â  Â  margin-bottom: 30px;
}

/* === The rest of your CSS remains unchanged as it is excellent for mobile. === */

.contestant-card {
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  border: 2px solid #e2e8f0;
Â  Â  border-radius: 10px;
Â  Â  padding: 15px;
Â  Â  margin-bottom: 15px;
Â  Â  cursor: pointer;
Â  Â  transition: all 0.2s;
Â  Â  position: relative;
Â  Â  background-color: #c7d6b5;
}
.contestant-card:hover {
Â  Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
Â  Â  border-color: #cbd5e0;
}
.contestant-card.selected {
Â  Â  border-color: #34d399;
Â  Â  background-color: #d1fae5;
Â  Â  box-shadow: 0 0 0 3px rgba(5, 240, 79, 0.5);
}

.photo-container,
.symbol-container {
Â  Â  width: 70px;
Â  Â  height: 70px;
Â  Â  flex-shrink: 0;
}
.photo-container {
Â  Â  margin-right: 15px;
}
.symbol-container {
Â  Â  margin-left: auto;
}

/* ğŸ–¼ï¸ General image sizing and borders */
.photo-container img,
.symbol-container img {
Â  Â  width: 100%; Â  Â  Â  
Â  Â  height: 100%; Â  Â  Â 
Â  Â  border: 1px solid #e2e8f0;
Â  Â  background-color: white;
}

/* ğŸ–¼ï¸ PHOTO: Square with Rounded Edges */
.photo-container img {
Â  Â  object-fit: contain; Â  Â  Â /* Fills the space (crops if necessary) */
Â  Â  border-radius: 8px; Â  Â  /* Rounded corners */
}

/* â­• SYMBOL: Perfect Circle */
.symbol-container img {
Â  Â  object-fit: contain; Â  Â /* Shrinks the entire symbol to fit inside the circle */
Â  Â  border-radius: 50%; Â  Â  /* Perfect circle shape */
}

.contestant-info {
Â  Â  flex-grow: 1;
}
.contestant-name {
Â  Â  font-size: 1.25rem;
Â  Â  font-weight: 700;
Â  Â  color: #5500ff;
Â  Â  margin-bottom: 5px;
}

.custom-checkbox {
Â  Â  width: 24px;
Â  Â  height: 24px;
Â  Â  border: 2px solid #021e01;
Â  Â  border-radius: 4px;
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  transition: background-color 0.2s, border-color 0.2s;
Â  Â  flex-shrink: 0;
Â  Â  margin-left: 15px;
}
.contestant-card.selected .custom-checkbox {
Â  Â  background-color: #10b981;
Â  Â  border-color: #10b981;
}
.custom-checkbox::after {
Â  Â  content: 'âœ“';
Â  Â  color: white;
Â  Â  font-size: 16px;
Â  Â  line-height: 1;
Â  Â  display: none;
}
.contestant-card.selected .custom-checkbox::after {
Â  Â  display: block;
}

.contestant-card input[type="checkbox"] {
Â  Â  position: absolute;
Â  Â  opacity: 0;
Â  Â  cursor: pointer;
Â  Â  height: 100%;
Â  Â  width: 100%;
Â  Â  top: 0;
Â  Â  left: 0;
Â  Â  margin: 0;
}

.submit-btn {
Â  Â  width: 20%;
Â  Â  padding: 15px;
Â  Â  background-color: #4c51bf;
Â  Â  color: white;
Â  Â  border: none;
Â  Â  border-radius: 8px;
Â  Â  font-size: 1.2rem;
Â  Â  font-weight: 700;
Â  Â  cursor: pointer;
Â  Â  display: block;
Â  Â  margin: 20px auto 0 auto;
}
.submit-btn:hover {
Â  Â  background-color: #3f42a6;
}

.overlay-message {
Â  Â  position: fixed;
Â  Â  top: 0;
Â  Â  left: 0;
Â  Â  width: 100%;
Â  Â  height: 100%;
Â  Â  background-color: rgba(0, 0, 0, 0.6);
Â  Â  display: none;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  z-index: 2000;
Â  Â  transition: opacity 0.3s;
Â  Â  pointer-events: none;
Â  Â  opacity: 0;
}
.overlay-message.show {
Â  Â  display: flex;
Â  Â  opacity: 1;
Â  Â  pointer-events: auto;
}
.message-box {
Â  Â  background-color: white;
Â  Â  padding: 30px;
Â  Â  border-radius: 10px;
Â  Â  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
Â  Â  text-align: center;
Â  Â  max-width: 90%;
}
.message-box h3 {
Â  Â  font-size: 1.5rem;
Â  Â  color: #10b981;
Â  Â  margin-bottom: 15px;
}
.message-box button {
Â  Â  background-color: #3b82f6;
Â  Â  color: white;
Â  Â  padding: 10px 20px;
Â  Â  border-radius: 6px;
Â  Â  font-weight: 600;
Â  Â  margin-top: 10px;
}

.instructions {
Â  Â  padding: 15px;
Â  Â  background-color: #fffbeb;
Â  Â  border: 1px solid #fcd34d;
Â  Â  border-radius: 8px;
Â  Â  margin-bottom: 20px;
Â  Â  font-weight: 600;
Â  Â  color: #b45309;
Â  Â  text-align: center;
}

@media (max-width: 600px) {
Â  Â  .ribbon h1 { font-size: 1.2rem; gap: 8px; }
Â  Â  .chakra { width: 35px; height: 35px; }
Â  Â  .contestant-card { flex-direction: column; text-align: center; }
Â  Â  .photo-container, .symbol-container { margin: 0 auto 10px auto; }
Â  Â  .submit-btn { width: 60%; font-size: 1rem; }
}
/* .chakra {
Â  Â  Â  width: 40px;
Â  Â  Â  height: 40px;
Â  Â  Â  animation: spinChakra 10s linear infinite;
Â  Â  Â  transform-origin: 50% 50%;
Â  Â  }

Â  Â  @keyframes spinChakra {
Â  Â  Â  from { transform: rotate(0deg); }
Â  Â  Â  to Â  { transform: rotate(360deg); }
Â  Â  } Â */

</style>
</head>

<body>

<div class="ribbon">
Â  Â  <h1>
Â  Â  Â  Â  {{ languages[selected_language_code]['ballotPaper'] if selected_language_code else 'BALLOT PAPER' }}
Â  Â  Â  Â  {% if tower_name %} â€“ {{ tower_name }}{% endif %} Â <span class="siva-text">&nbsp;&nbsp; SIVA</span>
Â  Â  </h1>
</div>

<div class="container">
Â  Â  <div class="instructions">
Â  Â  Â  Â  {{ languages[selected_language_code].get('selectInstructions', 'Select up to {max_choices} contestant(s).').replace('{max_choices}', maxSelections|string) }}
Â  Â  </div>

Â  Â  <form method="POST" action="{{ url_for('submit_vote') }}" id="ballot-form">
Â  Â  Â  Â  {% for contestant in contestants %}
Â  Â  Â  Â  <div class="contestant-card">
Â  Â  Â  Â  Â  Â  <div class="photo-container">
Â  Â  Â  Â  Â  Â  Â  Â  {% if contestant.photo_b64 %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="{{ contestant.photo_b64 }}" alt="{{ contestant.name }} Photo">
Â  Â  Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="photo-placeholder">ğŸ‘¤</div>
Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="contestant-info">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="contestant-name">{{ contestant.name }}</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="symbol-container">
Â  Â  Â  Â  Â  Â  Â  Â  {% if contestant.symbol_b64 %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="{{ contestant.symbol_b64 }}" alt="{{ contestant.name }} Symbol">
Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="custom-checkbox"></div>
Â  Â  Â  Â  Â  Â  <input type="checkbox" name="contestant" value="{{ contestant.name }}">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  {% endfor %}

Â  Â  Â  Â  <button type="submit" class="submit-btn">{{ languages[selected_language_code].get('submitVoteBtn', 'Submit Vote') }}</button>
Â  Â  Â  Â  <button type="button" id="cancel-vote" class="submit-btn" style="background-color: #ef4444;">
Â  Â  Â  Â  Â  Â  {{ languages[selected_language_code].get('cancelVoteBtn', 'Cancel') }}
Â  Â  Â  Â  </button>
Â  Â  </form>
</div>

<div class="overlay-message" id="overlay-message">
Â  Â  <div class="message-box">
Â  Â  Â  Â  <h3 id="overlay-title"></h3>
Â  Â  Â  Â  <p id="overlay-text"></p>
Â  Â  Â  Â  <button id="overlay-confirm-btn">{{ languages[selected_language_code].get('close', 'Close') }}</button>
Â  Â  </div>
</div>

Â  Â  <script>
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', function () {
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // CRITICAL FIX: Forces a fresh page load when user navigates back (BFcache prevention).
Â  Â  Â  Â  Â  Â  window.addEventListener('pageshow', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  if (event.persisted) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  location.reload(); 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const maxSelections = parseInt("{{ maxSelections }}");
Â  Â  Â  Â  Â  Â  const langData = {{ languages | tojson }};
Â  Â  Â  Â  Â  Â  const currentLangCode = "{{ selected_language_code }}";

Â  Â  Â  Â  Â  Â  const overlay = document.getElementById('overlay-message');
Â  Â  Â  Â  Â  Â  const overlayTitle = document.getElementById('overlay-title');
Â  Â  Â  Â  Â  Â  const overlayText = document.getElementById('overlay-text');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // The single button in the HTML overlay
Â  Â  Â  Â  Â  Â  const overlayConfirmBtn = document.getElementById('overlay-confirm-btn'); 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  let confirmAction = null; // Stores the function to run when the button is clicked

Â  Â  Â  Â  Â  Â  function getLocalizedString(key, defaultValue) {
Â  Â  Â  Â  Â  Â  Â  Â  // Safely access nested language data
Â  Â  Â  Â  Â  Â  Â  Â  return (langData[currentLangCode] && langData[currentLangCode][key]) ? langData[currentLangCode][key] : defaultValue;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  /**
Â  Â  Â  Â  Â  Â  Â * Shows the overlay with custom message/title and sets the action for the button.
Â  Â  Â  Â  Â  Â  Â * @param {string} message - The message body.
Â  Â  Â  Â  Â  Â  Â * @param {string} title - The title/header.
Â  Â  Â  Â  Â  Â  Â * @param {function} [action] - The function to execute on button click. If null, the button just dismisses.
Â  Â  Â  Â  Â  Â  Â * @param {string} [buttonText] - Custom text for the button.
Â  Â  Â  Â  Â  Â  Â */
Â  Â  Â  Â  Â  Â  function showOverlayMessage(message, title, action = null, buttonText = getLocalizedString('close', 'Close')) {
Â  Â  Â  Â  Â  Â  Â  Â  overlayTitle.textContent = title;
Â  Â  Â  Â  Â  Â  Â  Â  overlayText.textContent = message;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Set title color for Success/Error
Â  Â  Â  Â  Â  Â  Â  Â  const isSuccess = (title.toLowerCase() === getLocalizedString('success', 'success').toLowerCase() || title.toLowerCase() === getLocalizedString('thankYou', 'thank you').toLowerCase());
Â  Â  Â  Â  Â  Â  Â  Â  overlayTitle.style.color = isSuccess ? '#10b981' : '#ef4444';
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Set button text and store action
Â  Â  Â  Â  Â  Â  Â  Â  overlayConfirmBtn.textContent = buttonText;
Â  Â  Â  Â  Â  Â  Â  Â  confirmAction = action; 

Â  Â  Â  Â  Â  Â  Â  Â  // Set button color based on action type (red for exit, blue for close/stay)
Â  Â  Â  Â  Â  Â  Â  Â  overlayConfirmBtn.style.backgroundColor = action ? '#ef4444' : '#3b82f6';

Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.add('show');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Universal overlay button handler
Â  Â  Â  Â  Â  Â  overlayConfirmBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.remove('show');
Â  Â  Â  Â  Â  Â  Â  Â  if (confirmAction) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmAction(); // Execute stored action (like redirection for Cancel)
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  confirmAction = null; // Reset action
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // --- CANCEL BUTTON LOGIC (User not willing to vote) ---
Â  Â  Â  Â  Â  Â  const cancelVoteBtn = document.getElementById('cancel-vote');

Â  Â  Â  Â  Â  Â  cancelVoteBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  // Define the action: redirect to language select (Close the page)
Â  Â  Â  Â  Â  Â  Â  Â  const redirectAction = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Uses replace to prevent back button from returning to ballot
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.replace("{{ url_for('select_language') }}");
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  // Show confirmation overlay
Â  Â  Â  Â  Â  Â  Â  Â  showOverlayMessage(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('cancelVoteConfirm', 'Are you sure you want to cancel your vote? You will be taken back to the start.'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('cancelVoteTitle', 'Confirm Exit'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  redirectAction, // Action to be executed on confirmation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('yesCancel', 'Yes, Cancel') // Button text for confirmation
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // --- CANDIDATE SELECTION LOGIC (Unchanged) ---
Â  Â  Â  Â  Â  Â  const contestantCards = document.querySelectorAll('.contestant-card');
Â  Â  Â  Â  Â  Â  contestantCards.forEach(card => {
Â  Â  Â  Â  Â  Â  Â  Â  const checkbox = card.querySelector('input[type="checkbox"]');

Â  Â  Â  Â  Â  Â  Â  Â  card.addEventListener('click', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Prevent card click from toggling if user clicks directly on the checkbox
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event.target === checkbox) return; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkbox.checked = !checkbox.checked;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkbox.dispatchEvent(new Event('change'));
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  checkbox.addEventListener('change', function () {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const selectedCount = document.querySelectorAll('.contestant-card input[type="checkbox"]:checked').length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (checkbox.checked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (selectedCount > maxSelections) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkbox.checked = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorMsg = getLocalizedString('maxChoicesExceeded', 'You can select a maximum of {max_choices} choice(s).').replace('{max_choices}', maxSelections);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showOverlayMessage(errorMsg, getLocalizedString('submissionErrorTitle', 'Selection Error'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  card.classList.toggle('selected', checkbox.checked);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // --- SUBMISSION LOGIC (Thank You -> Close Sequence) ---
Â  Â  Â  Â  Â  Â  const form = document.getElementById('ballot-form');
Â  Â  Â  Â  Â  Â  form.addEventListener('submit', async function (event) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  const selectedCheckboxes = [...form.querySelectorAll('input[name="contestant"]:checked')];

Â  Â  Â  Â  Â  Â  Â  Â  if (selectedCheckboxes.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showOverlayMessage(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('noContestantSelected', 'Please select at least one contestant.'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('submissionErrorTitle', 'Submission Error')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // This check is effectively covered by the first check, but kept for explicit logic
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedCheckboxes.length < 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showOverlayMessage(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('minSelectionRequired', 'Please select at least one contestant.'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('submissionErrorTitle', 'Submission Error')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const selectedContestants = selectedCheckboxes.map(input => input.value);

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Disable form elements during submission to prevent double posting
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const submitBtn = form.querySelector('button[type="submit"]');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitBtn.disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // This POST goes to the /submit_vote route (in app_votingsys.py)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(form.action, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ contestants: selectedContestants })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // SEQUENCE STEP 1: Show "Thank You" message (briefly)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showOverlayMessage(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.message || getLocalizedString('voteRecorded', 'Your vote has been recorded successfully.'), 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('thankYou', 'Thank You'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  null, // No action needed on button click here (auto-redirect handles close)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('close', 'Close')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // SEQUENCE STEP 2 & 3: Close the page (redirect) after a short pause
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.replace("{{ url_for('select_language') }}");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 2000); // 2 seconds delay to allow user to read the message
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Error: Show message, let user dismiss the error box
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitBtn.disabled = false; // Re-enable button on error
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showOverlayMessage(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.message || getLocalizedString('errorSubmittingVote', 'Error submitting vote.'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getLocalizedString('submissionErrorTitle', 'Submission Error')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Network error
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showOverlayMessage(getLocalizedString('networkError', 'A network error occurred. Please try again.'));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â document.addEventListener('contextmenu', function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  });

Â  Â  Â  Â  document.addEventListener('keydown', function(e) {
Â  Â  Â  Â  Â  Â  if (e.ctrlKey && (e.key === 'c' || e.key === 'v' || e.key === 'x')) {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }); Â  Â 
Â  Â  </script>
Â  Â  Â  Â  <footer id="centered-dev-footer">
Â  Â  Â  Designed/Developed by: 
Â  Â  Â  <a href="mailto:vpchaya@gmail.com" style="color: #0000FF;" class="underline hover:text-blue-700">
Â  Â  Â  Â  vpchaya@gmail.com
Â  Â  Â  </a>
Â  Â  </footer>
</body>
</html>